<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vietnamese ‚Üî Lao Translator</title>
    <style>
      @font-face {
        font-family: "Phetsarath OT";
        src: url("./front/Phetsarath OT.ttf") format("truetype");
        font-weight: normal;
        font-style: normal;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        position: relative;
      }

      .header h1 {
        color: #333;
        font-size: 2.5rem;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header p {
        color: #666;
        font-size: 1.1rem;
      }

      /* Toggle Dark Mode Button */
      .darkmode-toggle {
        position: absolute;
        top: 0;
        right: 0;
        background: linear-gradient(45deg, #333, #764ba2);
        color: #fff;
        border: none;
        border-radius: 25px;
        padding: 10px 22px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        z-index: 10;
      }
      .darkmode-toggle:hover {
        background: linear-gradient(45deg, #764ba2, #333);
      }

      /* Language Switcher */
      .language-switcher {
        position: absolute;
        top: 0;
        left: 0;
        display: flex;
        gap: 5px;
        z-index: 10;
      }

      .lang-btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: #fff;
        border: none;
        border-radius: 20px;
        padding: 8px 15px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .lang-btn:hover {
        background: linear-gradient(45deg, #764ba2, #667eea);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .lang-btn.active {
        background: linear-gradient(45deg, #28a745, #20c997);
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      }

      .lang-btn.active:hover {
        background: linear-gradient(45deg, #20c997, #28a745);
      }

      /* Dark mode styles for language switcher */
      body.dark-mode .lang-btn {
        background: linear-gradient(45deg, #23272b, #764ba2);
      }
      body.dark-mode .lang-btn:hover {
        background: linear-gradient(45deg, #764ba2, #23272b);
      }
      body.dark-mode .lang-btn.active {
        background: linear-gradient(45deg, #218838, #13896b);
      }

      /* DARK MODE STYLES */
      body.dark-mode {
        background: linear-gradient(135deg, #232526 0%, #414345 100%);
      }
      body.dark-mode .container {
        background: rgba(30, 32, 34, 0.98);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }
      body.dark-mode .header h1 {
        color: #eee;
        background: linear-gradient(45deg, #b993d6, #8ca6db);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      body.dark-mode .header p {
        color: #bbb;
      }
      body.dark-mode .input-panel,
      body.dark-mode .output-panel,
      body.dark-mode .file-upload-section {
        background: #23272b;
        border-color: #444;
      }
      body.dark-mode .panel-title,
      body.dark-mode .file-upload-section h3 {
        color: #e0e0e0;
      }
      body.dark-mode .language-selector {
        background: #23272b;
        color: #b993d6;
        border-color: #b993d6;
      }
      body.dark-mode .language-selector:hover {
        background: #b993d6;
        color: #23272b;
      }
      body.dark-mode .text-input,
      body.dark-mode .text-output {
        background: #181a1b;
        color: #f1f1f1;
        border-color: #444;
      }
      body.dark-mode .text-output {
        border-color: #28a745;
      }
      body.dark-mode .controls .translate-btn {
        background: linear-gradient(45deg, #218838, #13896b);
      }
      body.dark-mode .controls .clear-btn {
        background: linear-gradient(45deg, #b52a37, #fd7e14);
      }
      body.dark-mode .controls .copy-btn {
        background: linear-gradient(45deg, #4b2c7c, #e83e8c);
      }
      body.dark-mode .file-input-btn {
        background: linear-gradient(45deg, #17a2b8, #764ba2);
      }
      body.dark-mode .file-info {
        background: #23272b;
        color: #eee;
        border-color: #444;
      }
      body.dark-mode .extracted-text {
        background: #181a1b;
        color: #f1f1f1;
        border-color: #17a2b8;
      }
      body.dark-mode .success-message {
        background: #233524;
        color: #b6fcb6;
        border-color: #28a745;
      }
      body.dark-mode .error-message {
        background: #3a1a1a;
        color: #ffb3b3;
        border-color: #b52a37;
      }
      body.dark-mode .copy-translated-btn {
        background: linear-gradient(45deg, #4b2c7c, #e83e8c);
        color: #fff;
      }
      body.dark-mode .copy-translated-btn:hover {
        background: linear-gradient(45deg, #218838, #13896b);
      }
      body.dark-mode .switch-btn {
        background: #23272b;
        color: #b993d6;
        border-color: #b993d6;
      }
      body.dark-mode .switch-btn:hover {
        background: #b993d6;
        color: #23272b;
      }
      body.dark-mode .translated-text-content.lao-text {
        color: #f1f1f1;
      }

      .translation-section {
        display: grid;
        grid-template-columns: 1fr auto 1fr; /* Thay ƒë·ªïi ƒë·ªÉ c√≥ 3 c·ªôt: input, switch button, output */
        grid-template-rows: auto;
        gap: 30px;
        margin-bottom: 30px;
        align-items: start; /* Th√™m ƒë·ªÉ cƒÉn ch·ªânh t·ª´ tr√™n xu·ªëng */
      }

      .input-panel {
        grid-column: 1;
        grid-row: 1;
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        border: 1px solid #e9ecef;
      }

      .output-panel {
        grid-column: 3;
        grid-row: 1;
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        border: 1px solid #e9ecef;
      }

      .switch-languages {
        grid-column: 2;
        grid-row: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0; /* B·ªè margin √¢m */
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .panel-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #333;
      }

      .language-selector {
        padding: 8px 16px;
        border: 2px solid #667eea;
        border-radius: 25px;
        background: white;
        color: #667eea;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .language-selector:hover {
        background: #667eea;
        color: white;
      }

      .text-input,
      .text-output {
        width: 100%;
        min-height: 200px;
        padding: 15px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 16px;
        font-family: inherit;
        resize: vertical;
        transition: border-color 0.3s ease;
      }

      .text-input:focus {
        outline: none;
        border-color: #667eea;
      }

      .text-output {
        background: #fff;
        border-color: #28a745;
        color: #333;
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 30px 0;
      }

      .translate-btn,
      .clear-btn,
      .copy-btn {
        padding: 15px 30px;
        border: none;
        border-radius: 50px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .translate-btn {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
      }

      .translate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
      }

      .translate-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
        transform: none;
      }

      .clear-btn {
        background: linear-gradient(45deg, #dc3545, #fd7e14);
        color: white;
      }

      .clear-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(220, 53, 69, 0.3);
      }

      .copy-btn {
        background: linear-gradient(45deg, #6f42c1, #e83e8c);
        color: white;
      }

      .copy-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(111, 66, 193, 0.3);
      }

      .file-upload-section {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        border: 2px dashed #adb5bd;
        text-align: center;
        margin-bottom: 30px;
      }

      .file-upload-section h3 {
        color: #495057;
        margin-bottom: 15px;
      }

      .file-input-wrapper {
        position: relative;
        display: inline-block;
      }

      .file-input {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
      }

      .file-input-btn {
        background: linear-gradient(45deg, #17a2b8, #6610f2);
        color: white;
        padding: 15px 30px;
        border-radius: 50px;
        border: none;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .file-input-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(23, 162, 184, 0.3);
      }

      .file-info {
        margin-top: 15px;
        padding: 10px;
        background: white;
        border-radius: 8px;
        border: 1px solid #dee2e6;
      }

      .extracted-text {
        background: white;
        border: 2px solid #17a2b8;
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        max-height: 300px;
        overflow-y: auto;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error-message {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border: 1px solid #f5c6cb;
      }

      .success-message {
        background: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border: 1px solid #c3e6cb;
      }

      /* C·∫≠p nh·∫≠t class cho text ti·∫øng L√†o */
      .lao-text {
        font-family: "Phetsarath OT", Arial, sans-serif !important;
        font-size: 18px !important;
        line-height: 1.8 !important;
      }

      /* √Åp d·ª•ng cho textarea khi c√≥ class lao-text */
      textarea.lao-text {
        font-family: "Phetsarath OT", Arial, sans-serif !important;
        font-size: 18px !important;
        line-height: 1.8 !important;
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
          padding: 20px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .language-switcher {
          position: static;
          margin: 15px 0;
          justify-content: center;
          order: 1;
        }

        .darkmode-toggle {
          position: static;
          margin: 10px 0;
          order: 2;
        }

        .header {
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        .translation-section {
          grid-template-columns: 1fr;
          grid-template-rows: auto auto auto;
          gap: 20px;
        }

        .input-panel {
          grid-column: 1;
          grid-row: 1;
        }

        .switch-languages {
          grid-column: 1;
          grid-row: 2;
        }

        .output-panel {
          grid-column: 1;
          grid-row: 3;
        }

        .controls {
          flex-direction: column;
          align-items: center;
        }

        .translate-btn,
        .clear-btn,
        .copy-btn {
          width: 100%;
          max-width: 300px;
        }
      }

      .switch-languages {
        grid-column: 1 / -1;
        text-align: center;
        margin: -15px 0;
      }

      .switch-btn {
        background: #fff;
        border: 2px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: #667eea;
        transition: all 0.3s ease;
      }

      .switch-btn:hover {
        background: #667eea;
        color: white;
        transform: rotate(180deg);
      }

      .translated-content-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .copy-translated-btn {
        background: linear-gradient(45deg, #6f42c1, #e83e8c);
        color: white;
        border: none;
        border-radius: 25px;
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .copy-translated-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(111, 66, 193, 0.3);
      }

      /* Th√™m CSS cho translated content alignment */
      .translated-text-content {
        text-align: left !important;
        direction: ltr;
        unicode-bidi: normal;
        white-space: pre-wrap;
        word-wrap: break-word;
        line-height: 1.6;
        padding: 0;
        margin: 0;
      }

      /* ƒê·∫£m b·∫£o font Lao c≈©ng cƒÉn tr√°i */
      .translated-text-content.lao-text {
        text-align: left !important;
        font-family: "Phetsarath OT", Arial, sans-serif !important;
        font-size: 18px !important;
        line-height: 1.8 !important;
      }

      .site-footer {
        text-align: center;
        padding: 24px 0 10px 0;
        color: #ecebeb;
        font-size: 1rem;
        background: none;
      }
      body.dark-mode .site-footer {
        color: #b993d6;
      }

      /* Lao Interface Font */
      body.lao-interface {
        font-family: "Phetsarath OT", Arial, sans-serif;
      }

      body.lao-interface .header h1,
      body.lao-interface .header p,
      body.lao-interface .panel-title,
      body.lao-interface .language-selector,
      body.lao-interface .text-input,
      body.lao-interface .text-output,
      body.lao-interface .translate-btn,
      body.lao-interface .clear-btn,
      body.lao-interface .copy-btn,
      body.lao-interface .file-upload-section h3,
      body.lao-interface .file-upload-section p,
      body.lao-interface .file-input-btn,
      body.lao-interface .file-info,
      body.lao-interface .extracted-text h4,
      body.lao-interface .loading p,
      body.lao-interface .error-message,
      body.lao-interface .success-message,
      body.lao-interface .site-footer,
      body.lao-interface .darkmode-toggle,
      body.lao-interface .lang-btn {
        font-family: "Phetsarath OT", Arial, sans-serif !important;
      }

      /* Ensure Lao text in translation areas always uses Phetsarath OT */
      .lao-text {
        font-family: "Phetsarath OT", Arial, sans-serif !important;
        font-size: 18px !important;
        line-height: 1.8 !important;
      }

      /* √Åp d·ª•ng cho textarea khi c√≥ class lao-text */
      textarea.lao-text {
        font-family: "Phetsarath OT", Arial, sans-serif !important;
        font-size: 18px !important;
        line-height: 1.8 !important;
      }

      /* History Section Styles */
      .history-section {
        margin: 30px 0;
      }

      .history-header {
        text-align: center;
        margin-bottom: 20px;
      }

      .history-toggle-btn {
        background: linear-gradient(45deg, #17a2b8, #6610f2);
        color: white;
        border: none;
        border-radius: 50px;
        padding: 15px 30px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 0 auto;
      }

      .history-toggle-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(23, 162, 184, 0.3);
      }

      .history-panel {
        background: #f8f9fa;
        border-radius: 15px;
        margin-top: 20px;
        border: 1px solid #e9ecef;
        max-height: 400px;
        overflow: hidden;
        animation: slideDown 0.3s ease;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .history-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 25px;
        border-bottom: 1px solid #e9ecef;
        background: linear-gradient(45deg, #f8f9fa, #e9ecef);
      }

      .history-panel-header h3 {
        margin: 0;
        color: #333;
        font-size: 1.2rem;
        font-weight: 600;
      }

      .history-actions {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .clear-history-btn {
        background: linear-gradient(45deg, #dc3545, #fd7e14);
        color: white;
        border: none;
        border-radius: 20px;
        padding: 8px 15px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .clear-history-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
      }

      .close-history-btn {
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      }

      .close-history-btn:hover {
        background: #5a6268;
        transform: rotate(90deg);
      }

      .history-content {
        max-height: 300px;
        overflow-y: auto;
        padding: 0;
      }

      .history-item {
        padding: 15px 25px;
        border-bottom: 1px solid #e9ecef;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
      }

      .history-item:hover {
        background-color: #e9ecef;
        transform: translateX(5px);
      }

      .history-item:last-child {
        border-bottom: none;
      }

      .history-item-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .history-item-text {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
      }

      .source-text,
      .translated-text {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 1;
        min-width: 200px;
      }

      .language-tag {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        min-width: 30px;
        text-align: center;
      }

      .text-preview {
        color: #333;
        font-size: 14px;
        line-height: 1.4;
        flex: 1;
      }

      .text-preview.lao-text {
        font-family: "Phetsarath OT", Arial, sans-serif !important;
        font-size: 16px !important;
      }

      .arrow {
        color: #667eea;
        font-size: 18px;
        font-weight: bold;
        margin: 0 10px;
      }

      .history-item-meta {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 5px;
      }

      .timestamp {
        color: #6c757d;
        font-size: 12px;
        font-style: italic;
      }

      .history-item-actions {
        display: flex;
        gap: 8px;
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      .history-item:hover .history-item-actions {
        opacity: 1;
      }

      .use-translation-btn,
      .delete-item-btn {
        background: #fff;
        border: 1px solid #dee2e6;
        border-radius: 20px;
        width: 35px;
        height: 35px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
      }

      .use-translation-btn:hover {
        background: #28a745;
        color: white;
        border-color: #28a745;
        transform: scale(1.1);
      }

      .delete-item-btn:hover {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
        transform: scale(1.1);
      }

      .history-empty {
        text-align: center;
        padding: 40px 20px;
        color: #6c757d;
      }

      .history-empty-icon {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
      }

      .history-empty p {
        font-size: 16px;
        margin-bottom: 5px;
        color: #495057;
      }

      .history-empty small {
        font-size: 14px;
        color: #6c757d;
      }

      /* Dark Mode Styles for History */
      body.dark-mode .history-panel {
        background: #23272b;
        border-color: #444;
      }

      body.dark-mode .history-panel-header {
        background: linear-gradient(45deg, #23272b, #2c3034);
        border-bottom-color: #444;
      }

      body.dark-mode .history-panel-header h3 {
        color: #f1f1f1;
      }

      body.dark-mode .history-item {
        border-bottom-color: #444;
        color: #f1f1f1;
      }

      body.dark-mode .history-item:hover {
        background-color: #2c3034;
      }

      body.dark-mode .text-preview {
        color: #f1f1f1;
      }

      body.dark-mode .text-preview.lao-text {
        color: #f1f1f1;
      }

      body.dark-mode .timestamp {
        color: #adb5bd;
      }

      body.dark-mode .use-translation-btn,
      body.dark-mode .delete-item-btn {
        background: #2c3034;
        border-color: #495057;
        color: #f1f1f1;
      }

      body.dark-mode .history-empty {
        color: #adb5bd;
      }

      body.dark-mode .history-empty p {
        color: #ced4da;
      }

      /* Responsive Design for History */
      @media (max-width: 768px) {
        .history-panel {
          max-height: 350px;
        }

        .history-item {
          padding: 12px 15px;
        }

        .history-item-text {
          flex-direction: column;
          gap: 10px;
          align-items: flex-start;
        }

        .source-text,
        .translated-text {
          min-width: auto;
          width: 100%;
        }

        .arrow {
          transform: rotate(90deg);
          margin: 5px 0;
          align-self: center;
        }

        .history-item-actions {
          opacity: 1;
          flex-direction: column;
          gap: 5px;
        }

        .use-translation-btn,
        .delete-item-btn {
          width: 30px;
          height: 30px;
          font-size: 12px;
        }

        .history-toggle-btn {
          padding: 12px 25px;
          font-size: 14px;
        }
      }

      /* Lao Interface Font for History */
      body.lao-interface .history-toggle-btn,
      body.lao-interface .history-panel-header h3,
      body.lao-interface .clear-history-btn,
      body.lao-interface .history-empty p,
      body.lao-interface .history-empty small {
        font-family: "Phetsarath OT", Arial, sans-serif !important;
      }

      /* Buy Me A Coffee Modal */
      .bmc-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px); /* Safari support */
      }

      .bmc-modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
        border-radius: 15px;
        text-align: center;
        position: relative;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      body.dark-mode .bmc-modal-content {
        background-color: #2c3034;
        border-color: #444;
        color: #f1f1f1;
      }

      .bmc-close-btn {
        color: #aaa;
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .bmc-close-btn:hover,
      .bmc-close-btn:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
      }
      body.dark-mode .bmc-close-btn:hover,
      body.dark-mode .bmc-close-btn:focus {
        color: #fff;
      }

      .qr-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      .qr-container img {
        max-width: 45%;
        height: auto;
        border-radius: 10px;
        border: 2px solid #667eea;
      }
      body.dark-mode .qr-container img {
        border-color: #b993d6;
      }

      .bmc-link {
        cursor: pointer;
        text-decoration: underline;
      }
      .bmc-link:hover {
        color: #fff;
      }
      body.dark-mode .bmc-link {
        color: #b993d6;
      }
      body.dark-mode .bmc-link:hover {
        color: #fff;
      }

      /* Character Counter */
      .char-counter {
        text-align: right;
        font-size: 0.9rem;
        color: #6c757d;
        margin-top: 10px;
        padding-right: 5px;
      }

      .char-counter.limit-exceeded {
        color: #dc3545;
        font-weight: bold;
      }

      body.dark-mode .char-counter {
        color: #adb5bd;
      }

      body.dark-mode .char-counter.limit-exceeded {
        color: #fd7e14;
      }

      /* Privacy Policy Modal */
      .privacy-modal {
        display: none; /* Hidden by default, shown via JS */
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        align-items: center;
        justify-content: center;
      }

      .privacy-modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 30px;
        border: 1px solid #888;
        width: 90%;
        max-width: 550px;
        border-radius: 15px;
        text-align: left;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .privacy-modal-content h2 {
        font-size: 1.5rem;
        margin-bottom: 15px;
        color: #333;
        text-align: center;
      }

      .privacy-modal-content p {
        font-size: 1rem;
        color: #555;
        margin-bottom: 20px;
      }

      .privacy-modal-content ul {
        list-style-position: inside;
        padding-left: 10px;
        margin-bottom: 25px;
      }

      .privacy-modal-content li {
        font-size: 1rem;
        color: #555;
        margin-bottom: 10px;
        line-height: 1.5;
      }

      #privacy-consent-btn {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
        border: none;
        border-radius: 50px;
        padding: 15px 30px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: block;
        width: 100%;
      }

      #privacy-consent-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
      }

      body.dark-mode .privacy-modal-content {
        background-color: #2c3034;
        border-color: #444;
      }
      body.dark-mode .privacy-modal-content h2,
      body.dark-mode .privacy-modal-content p,
      body.dark-mode .privacy-modal-content li {
        color: #f1f1f1;
      }
    </style>
  </head>
  <body>
    <div id="privacy-policy-modal" class="privacy-modal">
      <div class="privacy-modal-content">
        <h2>Ch√≠nh s√°ch B·∫£o m·∫≠t & ƒêi·ªÅu kho·∫£n S·ª≠ d·ª•ng</h2>
        <p>Vui l√≤ng ƒë·ªçc v√† ƒë·ªìng √Ω v·ªõi c√°c ƒëi·ªÅu kho·∫£n sau ƒë·ªÉ ti·∫øp t·ª•c s·ª≠ d·ª•ng d·ªãch v·ª•:</p>
        <ul>
            <li>Ch√∫ng t√¥i s·∫Ω kh√¥ng ch·ªãu tr√°ch nhi·ªám cho b·∫•t k·ª≥ sai s√≥t n√†o trong b·∫£n d·ªãch.</li>
            <li>Kh√¥ng c√≥ d·ªØ li·ªáu n√†o c·ªßa b·∫°n ƒë∆∞·ª£c ghi l·∫°i.</li>
            <li>Kh√¥ng c√≥ t√†i li·ªáu n√†o c·ªßa b·∫°n ƒë∆∞·ª£c l∆∞u tr·ªØ.</li>
        </ul>
        <button id="privacy-consent-btn">ƒê·ªìng √Ω v√† Ti·∫øp t·ª•c</button>
      </div>
    </div>

    <div class="container" id="main-container">
      <!-- Header -->
      <div class="header">
        <h1>üåê Vietnamese ‚Üî Lao Translator</h1>
        <p>Translate between Vietnamese and Lao languages using AI</p>

        <!-- Language Switcher -->
        <div class="language-switcher">
          <button class="lang-btn active" data-lang="en">üá∫üá∏ EN</button>
          <button class="lang-btn" data-lang="vi">üáªüá≥ VI</button>
          <button class="lang-btn" data-lang="lo">üá±üá¶ ‡∫•‡∫≤‡∫ß</button>
        </div>

        <button
          class="darkmode-toggle"
          id="darkmodeToggle"
          title="Toggle Dark/Light Mode"
        >
          üåô Dark Mode
        </button>
      </div>

      <!-- X√≥a ph·∫ßn API Configuration HTML -->

      <!-- Translation Section -->
      <div class="translation-section">
        <div class="input-panel">
          <div class="panel-header">
            <div class="panel-title">Input Text</div>
            <button class="language-selector" id="sourceLang">
              Vietnamese
            </button>
          </div>
          <textarea
            class="text-input"
            id="inputText"
            placeholder="Enter text to translate..."
            maxlength="5000"
          ></textarea>
          <div id="charCounter" class="char-counter">0/5000</div>
        </div>

        <div class="switch-languages">
          <button class="switch-btn" id="switchBtn" title="Switch Languages">
            ‚áÑ
          </button>
        </div>

        <div class="output-panel">
          <div class="panel-header">
            <div class="panel-title">Translation</div>
            <button class="language-selector" id="targetLang">Lao</button>
          </div>
          <textarea
            class="text-output"
            id="outputText"
            placeholder="Translation will appear here..."
            readonly
          ></textarea>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="translate-btn" id="translateBtn">
          <span>üîÑ</span> Translate
        </button>
        <button class="clear-btn" id="clearBtn"><span>üóëÔ∏è</span> Clear</button>
        <button class="copy-btn" id="copyBtn">
          <span>üìã</span> Copy Translation
        </button>
      </div>

      <!-- Loading indicator -->
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Translating...</p>
      </div>

      <!-- History Section -->
      <div class="history-section">
        <div class="history-header">
          <button class="history-toggle-btn" id="historyToggleBtn">
            <span>üìö</span> Translation History
          </button>
        </div>
        
        <div class="history-panel" id="historyPanel" style="display: none;">
          <div class="history-panel-header">
            <h3 id="historyPanelTitle">Recent Translations</h3>
            <div class="history-actions">
              <button class="clear-history-btn" id="clearHistoryBtn">
                <span>üóëÔ∏è</span> <span id="clearHistoryText">Clear All</span>
              </button>
              <button class="close-history-btn" id="closeHistoryBtn">
                <span>‚úï</span>
              </button>
            </div>
          </div>
          
          <div class="history-content" id="historyContent">
            <!-- History items will be dynamically generated here -->
          </div>
          
          <div class="history-empty" id="historyEmpty" style="display: none;">
            <div class="history-empty-icon">üìö</div>
            <p id="historyEmptyText">No translation history yet</p>
            <small id="historyEmptySubtext">Your translations will appear here</small>
          </div>
        </div>
      </div>

      <!-- File Upload Section -->
      <div class="file-upload-section">
        <h3>üìÅ Upload Document for Translation</h3>
        <p style="margin-bottom: 20px; color: #6c757d">
          Support for DOCX, PDF, and image files (JPG, PNG)
        </p>

        <div class="file-input-wrapper">
          <input
            type="file"
            class="file-input"
            id="fileInput"
            accept=".docx,.pdf,.jpg,.jpeg,.png"
          />
          <button class="file-input-btn">Choose File</button>
        </div>

        <div class="file-info" id="fileInfo" style="display: none">
          <p><strong>File:</strong> <span id="fileName"></span></p>
          <p><strong>Size:</strong> <span id="fileSize"></span></p>
          <p><strong>Type:</strong> <span id="fileType"></span></p>
        </div>

        <div class="extracted-text" id="extractedText" style="display: none">
          <h4>Extracted Text:</h4>
          <div id="extractedContent"></div>
          <button
            class="translate-btn"
            id="translateFileBtn"
            style="margin-top: 15px"
          >
            <span>üîÑ</span> Translate Extracted Text
          </button>
        </div>
      </div>

      <!-- Messages -->
      <div id="messages"></div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
      ¬© <span id="copyrightYear"></span>
      <a
        href="https://www.facebook.com/khamkoxys"
        target="_blank"
        rel="noopener"
        style="color: inherit; text-decoration: underline; cursor: pointer"
        >Khamko</a
      >. <span id="footerText">All rights reserved.</span> |
      <a id="buy-me-a-coffee" class="bmc-link">Buy Me a Coffee</a>
    </footer>

    <!-- Buy Me a Coffee Modal -->
    <div id="bmc-modal" class="bmc-modal">
      <div class="bmc-modal-content">
        <span class="bmc-close-btn">&times;</span>
        <h2>Buy Me a Coffee</h2>
        <p>If you find this tool helpful, please consider supporting me.</p>
        <div class="qr-container">
          <img src="./front/QR.jpg" alt="QR Code for Momo" />
          <img src="./front/QR1.jpg" alt="QR Code for Bank" />
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
      class VietnameseLaoTranslator {
        constructor() {
          // API key ƒë∆∞·ª£c c·∫•u h√¨nh tr·ª±c ti·∫øp trong code
          this.apiKey = "AIzaSyCby_DhyWaI4N5eTX41ERE7HmyEVB_awpc"; // Thay th·∫ø b·∫±ng API key th·ª±c c·ªßa b·∫°n
          this.isVietnameseToLao = true;
          this.currentLang = "en"; // Default language
          this.charLimit = 5000; // Character limit for translation

          // Language translations
          this.translations = {
            en: {
              title: "üåê Vietnamese ‚Üî Lao Translator",
              subtitle:
                "Translate between Vietnamese and Lao languages using AI",
              inputText: "Input Text",
              translation: "Translation",
              vietnamese: "Vietnamese",
              lao: "Lao",
              enterTextPlaceholder: "Enter text to translate...",
              translationPlaceholder: "Translation will appear here...",
              translate: "üîÑ Translate",
              clear: "üóëÔ∏è Clear",
              copyTranslation: "üìã Copy Translation",
              translating: "Translating...",
              uploadDocument: "üìÅ Upload Document for Translation",
              uploadDescription:
                "Support for DOCX, PDF, and image files (JPG, PNG)",
              chooseFile: "Choose File",
              file: "File",
              size: "Size",
              type: "Type",
              extractedText: "Extracted Text:",
              translateExtractedText: "üîÑ Translate Extracted Text",
              darkMode: "üåô Dark Mode",
              lightMode: "‚òÄÔ∏è Light Mode",
              switchLanguages: "Switch Languages",
              copyTranslatedText: "üìã Copy Translation", // Gi·ªØ nguy√™n theo y√™u c·∫ßu, d√π c√≥ th·ªÉ l√† "Copy Translated Text"
              copied: "‚úÖ Copied!",
              allRightsReserved: "All rights reserved.",
              // Messages
              enterTextToTranslate: "Please enter text to translate.",
              textLimitExceeded: "You have exceeded the character limit.",
              apiKeyNotConfigured:
                "API key is not configured. Please set your Gemini API key in the code.",
              translationCompleted: "Translation completed successfully!",
              translationFailed: "Translation failed:",
              noTranslationToCopy: "No translation to copy.",
              translationCopied: "Translation copied to clipboard!",
              textExtractedSuccessfully: "Text extracted successfully!",
              failedToProcessFile: "Failed to process file:",
              noExtractedTextToTranslate: "No extracted text to translate.",
              translatedTextCopied: "Translated text copied to clipboard!",
              failedToCopyText:
                "Failed to copy text. Please select and copy manually.",
              // History feature strings
              translationHistory: "üìö Translation History",
              recentTranslations: "Recent Translations",
              clearAllHistory: "üóëÔ∏è Clear All",
              noHistoryYet: "No translation history yet",
              historySubtext: "Your translations will appear here",
              historyCleared: "Translation history cleared successfully",
              historyItemDeleted: "History item deleted",
              historyLoadedFromHistory: "Translation loaded from history",
              confirmClearHistory: "Are you sure you want to clear all translation history? This action cannot be undone.",
              justNow: "Just now",
              minuteAgo: "minute ago",
              minutesAgo: "minutes ago",
              hourAgo: "hour ago", 
              hoursAgo: "hours ago",
              dayAgo: "day ago",
              daysAgo: "days ago",
            },
            vi: {
              title: "üåê D·ªãch Thu·∫≠t Vi·ªát ‚Üî L√†o",
              subtitle: "D·ªãch thu·∫≠t gi·ªØa ti·∫øng Vi·ªát v√† ti·∫øng L√†o b·∫±ng AI",
              inputText: "VƒÉn B·∫£n ƒê·∫ßu V√†o",
              translation: "B·∫£n D·ªãch",
              vietnamese: "Ti·∫øng Vi·ªát",
              lao: "Ti·∫øng L√†o",
              enterTextPlaceholder: "Nh·∫≠p vƒÉn b·∫£n c·∫ßn d·ªãch...",
              translationPlaceholder: "B·∫£n d·ªãch s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y...",
              translate: "üîÑ D·ªãch", // G·ª£i √Ω
              clear: "üóëÔ∏è X√≥a",
              copyTranslation: "üìã Sao Ch√©p B·∫£n D·ªãch",
              translating: "ƒêang d·ªãch...",
              uploadDocument: "üìÅ T·∫£i L√™n T√†i Li·ªáu ƒê·ªÉ D·ªãch",
              uploadDescription: "H·ªó tr·ª£ file DOCX, PDF v√† h√¨nh ·∫£nh (JPG, PNG)",
              chooseFile: "Ch·ªçn T·ªáp",
              file: "T·ªáp",
              size: "K√≠ch Th∆∞·ªõc",
              type: "Lo·∫°i",
              extractedText: "VƒÉn B·∫£n ƒê√£ Tr√≠ch Xu·∫•t:",
              translateExtractedText: "üîÑ D·ªãch VƒÉn B·∫£n Tr√≠ch Xu·∫•t", // G·ª£i √Ω
              darkMode: "üåô Ch·∫ø ƒê·ªô T·ªëi",
              lightMode: "‚òÄÔ∏è Ch·∫ø ƒê·ªô S√°ng",
              switchLanguages: "Chuy·ªÉn ƒê·ªïi Ng√¥n Ng·ªØ",
              copyTranslatedText: "üìã Sao Ch√©p B·∫£n D·ªãch",
              copied: "‚úÖ ƒê√£ Sao Ch√©p!",
              allRightsReserved: "B·∫£o l∆∞u m·ªçi quy·ªÅn.",
              // Messages
              enterTextToTranslate: "Vui l√≤ng nh·∫≠p vƒÉn b·∫£n c·∫ßn d·ªãch.",
              textLimitExceeded: "B·∫°n ƒë√£ v∆∞·ª£t qu√° gi·ªõi h·∫°n k√Ω t·ª±.",
              apiKeyNotConfigured:
                "API key ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh. Vui l√≤ng ƒë·∫∑t Gemini API key trong code.",
              translationCompleted: "ƒê√£ d·ªãch th√†nh c√¥ng!", // G·ª£i √Ω
              translationFailed: "D·ªãch th·∫•t b·∫°i:", // G·ª£i √Ω
              noTranslationToCopy: "Kh√¥ng c√≥ b·∫£n d·ªãch ƒë·ªÉ sao ch√©p.",
              translationCopied: "ƒê√£ sao ch√©p b·∫£n d·ªãch v√†o clipboard!",
              textExtractedSuccessfully: "Tr√≠ch xu·∫•t vƒÉn b·∫£n th√†nh c√¥ng!",
              failedToProcessFile: "Kh√¥ng th·ªÉ x·ª≠ l√Ω t·ªáp:",
              noExtractedTextToTranslate:
                "Kh√¥ng c√≥ vƒÉn b·∫£n ƒë√£ tr√≠ch xu·∫•t ƒë·ªÉ d·ªãch.",
              translatedTextCopied:
                "ƒê√£ sao ch√©p vƒÉn b·∫£n ƒë√£ d·ªãch v√†o clipboard!",
              failedToCopyText:
                "Kh√¥ng th·ªÉ sao ch√©p vƒÉn b·∫£n. Vui l√≤ng ch·ªçn v√† sao ch√©p th·ªß c√¥ng.",
              // History feature strings
              translationHistory: "üìö L·ªãch S·ª≠ D·ªãch Thu·∫≠t",
              recentTranslations: "B·∫£n D·ªãch G·∫ßn ƒê√¢y",
              clearAllHistory: "üóëÔ∏è X√≥a T·∫•t C·∫£",
              noHistoryYet: "Ch∆∞a c√≥ l·ªãch s·ª≠ d·ªãch thu·∫≠t",
              historySubtext: "C√°c b·∫£n d·ªãch c·ªßa b·∫°n s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y",
              historyCleared: "ƒê√£ x√≥a l·ªãch s·ª≠ d·ªãch thu·∫≠t th√†nh c√¥ng",
              historyItemDeleted: "ƒê√£ x√≥a m·ª•c l·ªãch s·ª≠",
              historyLoadedFromHistory: "ƒê√£ t·∫£i b·∫£n d·ªãch t·ª´ l·ªãch s·ª≠",
              confirmClearHistory: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ d·ªãch thu·∫≠t? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.",
              justNow: "V·ª´a xong",
              minuteAgo: "ph√∫t tr∆∞·ªõc",
              minutesAgo: "ph√∫t tr∆∞·ªõc",
              hourAgo: "gi·ªù tr∆∞·ªõc",
              hoursAgo: "gi·ªù tr∆∞·ªõc", 
              dayAgo: "ng√†y tr∆∞·ªõc",
              daysAgo: "ng√†y tr∆∞·ªõc",
            },
            lo: {
              title: "üåê ‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤ ‡∫´‡∫ß‡∫Ω‡∫î‡∫ô‡∫≤‡∫° ‚Üî ‡∫•‡∫≤‡∫ß",
              subtitle: "‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫∞‡∫´‡∫ß‡ªà‡∫≤‡∫á‡∫û‡∫≤‡∫™‡∫≤‡∫´‡∫ß‡∫Ω‡∫î‡∫ô‡∫≤‡∫° ‡ªÅ‡∫•‡∫∞ ‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫≤‡∫ß ‡ªÇ‡∫î‡∫ç‡ªÉ‡∫ä‡ªâ AI",
              inputText: "‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤",
              translation: "‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤",
              vietnamese: "‡∫û‡∫≤‡∫™‡∫≤‡∫´‡∫ß‡∫Ω‡∫î‡∫ô‡∫≤‡∫°",
              lao: "‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫≤‡∫ß",
              enterTextPlaceholder: "‡∫õ‡ªâ‡∫≠‡∫ô‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ó‡∫µ‡ªà‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤...",
              translationPlaceholder: "‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫à‡∫∞‡∫õ‡∫≤‡∫Å‡∫ª‡∫î‡∫ó‡∫µ‡ªà‡∫ô‡∫µ‡ªâ...",
              translate: "üîÑ ‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤",
              clear: "üóëÔ∏è ‡∫•‡∫∂‡∫ö",
              copyTranslation: "üìã ‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤",
              translating: "‡∫Å‡∫≥‡∫•‡∫±‡∫á‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤...",
              uploadDocument: "üìÅ ‡∫≠‡∫±‡∫ö‡ªÇ‡∫´‡∫•‡∫î‡ªÄ‡∫≠‡∫Å‡∫∞‡∫™‡∫≤‡∫ô‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤",
              uploadDescription: "‡∫Æ‡∫≠‡∫á‡∫Æ‡∫±‡∫ö‡ªÑ‡∫ü‡∫•‡ªå DOCX, PDF ‡ªÅ‡∫•‡∫∞ ‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö (JPG, PNG)",
              chooseFile: "‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡ªÑ‡∫ü‡∫•‡ªå",
              file: "‡ªÑ‡∫ü‡∫•‡ªå",
              size: "‡∫Ç‡∫∞‡ªú‡∫≤‡∫î",
              type: "‡∫õ‡∫∞‡ªÄ‡∫û‡∫î",
              extractedText: "‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ó‡∫µ‡ªà‡∫™‡∫∞‡∫Å‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß:",
              translateExtractedText: "üîÑ ‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ó‡∫µ‡ªà‡∫™‡∫∞‡∫Å‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß",
              darkMode: "üåô ‡ªÇ‡ªù‡∫î‡∫°‡∫∑‡∫î",
              lightMode: "‚òÄÔ∏è ‡ªÇ‡ªù‡∫î‡ªÅ‡∫à‡ªâ‡∫á",
              switchLanguages: "‡∫™‡∫∞‡∫´‡∫º‡∫±‡∫ö‡∫û‡∫≤‡∫™‡∫≤",
              copyTranslatedText: "üìã ‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ó‡∫µ‡ªà‡ªÅ‡∫õ‡ªÅ‡∫•‡ªâ‡∫ß",
              copied: "‚úÖ ‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡ªÅ‡∫•‡ªâ‡∫ß!",
              allRightsReserved: "‡∫™‡∫∞‡∫´‡∫á‡∫ß‡∫ô‡∫•‡∫¥‡∫Ç‡∫∞‡∫™‡∫¥‡∫î‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î.",
              // Messages
              enterTextToTranslate: "‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫õ‡ªâ‡∫≠‡∫ô‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ó‡∫µ‡ªà‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤.",
              textLimitExceeded: "‡∫ó‡ªà‡∫≤‡∫ô‡ªÑ‡∫î‡ªâ‡ªÄ‡∫Å‡∫µ‡∫ô‡∫Ç‡∫µ‡∫î‡∫à‡∫≥‡∫Å‡∫±‡∫î‡∫ï‡∫ª‡∫ß‡∫≠‡∫±‡∫Å‡∫™‡∫≠‡∫ô‡ªÅ‡∫•‡ªâ‡∫ß.",
              apiKeyNotConfigured:
                "API key ‡∫ç‡∫±‡∫á‡∫ö‡ªç‡ªà‡ªÑ‡∫î‡ªâ‡∫ï‡∫±‡ªâ‡∫á‡∫Ñ‡ªà‡∫≤. ‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫ï‡∫±‡ªâ‡∫á Gemini API key ‡ªÉ‡∫ô code.",
              translationCompleted: "‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß!", // G·ª£i √Ω
              translationFailed: "‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫ª‡ªâ‡∫°‡ªÄ‡∫´‡∫•‡∫ß:",
              noTranslationToCopy: "‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡ªÉ‡∫´‡ªâ‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å.",
              translationCopied: "‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡ªÑ‡∫õ clipboard ‡ªÅ‡∫•‡ªâ‡∫ß!",
              textExtractedSuccessfully: "‡∫™‡∫∞‡∫Å‡∫±‡∫î‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß!", // G·ª£i √Ω (t√πy ch·ªçn)
              failedToProcessFile: "‡∫ö‡ªç‡ªà‡∫™‡∫≤‡∫°‡∫≤‡∫î‡∫õ‡∫∞‡∫°‡∫ß‡∫ô‡∫ú‡∫ª‡∫ô‡ªÑ‡∫ü‡∫•‡ªå‡ªÑ‡∫î‡ªâ:",
              noExtractedTextToTranslate: "‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ó‡∫µ‡ªà‡∫™‡∫∞‡∫Å‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß‡ªÉ‡∫´‡ªâ‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤.",
              translatedTextCopied: "‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡∫ó‡∫µ‡ªà‡ªÅ‡∫õ‡ªÅ‡∫•‡ªâ‡∫ß‡ªÑ‡∫õ clipboard ‡ªÅ‡∫•‡ªâ‡∫ß!",
              failedToCopyText:
                "‡∫ö‡ªç‡ªà‡∫™‡∫≤‡∫°‡∫≤‡∫î‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡∫Ç‡ªç‡ªâ‡∫Ñ‡∫ß‡∫≤‡∫°‡ªÑ‡∫î‡ªâ. ‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å ‡ªÅ‡∫•‡∫∞ ‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡∫î‡ªâ‡∫ß‡∫ç‡∫ï‡∫ª‡∫ô‡ªÄ‡∫≠‡∫á.",
              // History feature strings
              translationHistory: "üìö ‡∫õ‡∫∞‡∫´‡∫ß‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤",
              recentTranslations: "‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫´‡∫º‡ªâ‡∫≤‡∫™‡∫∏‡∫î",
              clearAllHistory: "üóëÔ∏è ‡∫•‡∫∂‡∫ö‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î",
              noHistoryYet: "‡∫ç‡∫±‡∫á‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫õ‡∫∞‡∫´‡∫ß‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤",
              historySubtext: "‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫Ç‡∫≠‡∫á‡ªÄ‡∫à‡∫ª‡ªâ‡∫≤‡∫à‡∫∞‡∫õ‡∫≤‡∫Å‡∫ª‡∫î‡∫ó‡∫µ‡ªà‡∫ô‡∫µ‡ªâ",
              historyCleared: "‡∫•‡∫∂‡∫ö‡∫õ‡∫∞‡∫´‡∫ß‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß",
              historyItemDeleted: "‡∫•‡∫∂‡∫ö‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫õ‡∫∞‡∫´‡∫ß‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß",
              historyLoadedFromHistory: "‡ªÇ‡∫´‡∫•‡∫î‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫à‡∫≤‡∫Å‡∫õ‡∫∞‡∫´‡∫ß‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß",
              confirmClearHistory: "‡ªÄ‡∫à‡∫ª‡ªâ‡∫≤‡ªÅ‡∫ô‡ªà‡ªÉ‡∫à‡∫ö‡ªç‡ªà‡∫ß‡ªà‡∫≤‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö‡∫õ‡∫∞‡∫´‡∫ß‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡ªÅ‡∫õ‡∫û‡∫≤‡∫™‡∫≤‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î? ‡∫Å‡∫≤‡∫ô‡∫Å‡∫∞‡∫ó‡∫≥‡∫ô‡∫µ‡ªâ‡∫ö‡ªç‡ªà‡∫™‡∫≤‡∫°‡∫≤‡∫î‡∫ç‡∫ª‡∫Å‡ªÄ‡∫•‡∫µ‡∫Å‡ªÑ‡∫î‡ªâ.",
              justNow: "‡∫´‡∫≤‡∫Å‡ªç‡ªà‡∫ô‡∫µ‡ªâ",
              minuteAgo: "‡∫ô‡∫≤‡∫ó‡∫µ‡∫Å‡ªà‡∫≠‡∫ô",
              minutesAgo: "‡∫ô‡∫≤‡∫ó‡∫µ‡∫Å‡ªà‡∫≠‡∫ô",
              hourAgo: "‡∫ä‡∫ª‡ªà‡∫ß‡ªÇ‡∫°‡∫á‡∫Å‡ªà‡∫≠‡∫ô",
              hoursAgo: "‡∫ä‡∫ª‡ªà‡∫ß‡ªÇ‡∫°‡∫á‡∫Å‡ªà‡∫≠‡∫ô",
              dayAgo: "‡∫°‡∫∑‡ªâ‡∫Å‡ªà‡∫≠‡∫ô", 
              daysAgo: "‡∫°‡∫∑‡ªâ‡∫Å‡ªà‡∫≠‡∫ô",
            },
          };

          this.initializeElements();
          this.attachEventListeners();
          this.updateFontStyles();
          this.initDarkMode();
          this.initLanguage(); // Initialize language
          
          // Initialize translation history
          this.history = new TranslationHistory(this);
        }

        initializeElements() {
          // Main elements
          this.inputText = document.getElementById("inputText");
          this.outputText = document.getElementById("outputText");
          this.sourceLang = document.getElementById("sourceLang");
          this.targetLang = document.getElementById("targetLang");
          this.charCounter = document.getElementById("charCounter");

          // Buttons
          this.translateBtn = document.getElementById("translateBtn");
          this.clearBtn = document.getElementById("clearBtn");
          this.copyBtn = document.getElementById("copyBtn");
          this.switchBtn = document.getElementById("switchBtn");

          // File upload elements
          this.fileInput = document.getElementById("fileInput");
          this.fileInfo = document.getElementById("fileInfo");
          this.fileName = document.getElementById("fileName");
          this.fileSize = document.getElementById("fileSize");
          this.fileType = document.getElementById("fileType");
          this.extractedText = document.getElementById("extractedText");
          this.extractedContent = document.getElementById("extractedContent");
          this.translateFileBtn = document.getElementById("translateFileBtn");

          // UI elements
          this.loading = document.getElementById("loading");
          this.messages = document.getElementById("messages");

          // Language switcher elements
          this.langButtons = document.querySelectorAll(".lang-btn");

          // History elements
          this.historyToggleBtn = document.getElementById("historyToggleBtn");
          this.historyPanel = document.getElementById("historyPanel");
          this.clearHistoryBtn = document.getElementById("clearHistoryBtn");
          this.closeHistoryBtn = document.getElementById("closeHistoryBtn");
        }

        initLanguage() {
          // Check localStorage for saved language
          const savedLang = localStorage.getItem("interfaceLanguage");
          if (savedLang && this.translations[savedLang]) {
            this.currentLang = savedLang;
          }

          // Update language buttons
          this.updateLanguageButtons();

          // Apply translations
          this.updateInterfaceLanguage();
        }

        updateLanguageButtons() {
          this.langButtons.forEach((btn) => {
            btn.classList.remove("active");
            if (btn.dataset.lang === this.currentLang) {
              btn.classList.add("active");
            }
          });
        }

        updateInterfaceLanguage() {
          const t = this.translations[this.currentLang];

          // Add/remove Lao interface class
          if (this.currentLang === "lo") {
            document.body.classList.add("lao-interface");
          } else {
            document.body.classList.remove("lao-interface");
          }

          // Update header
          document.querySelector(".header h1").textContent = t.title;
          document.querySelector(".header p").textContent = t.subtitle;

          // Update dark mode button
          this.updateDarkModeButton();

          // Update translation section
          document.querySelector(".input-panel .panel-title").textContent =
            t.inputText;
          document.querySelector(".output-panel .panel-title").textContent =
            t.translation;

          // Update placeholders
          this.inputText.placeholder = t.enterTextPlaceholder;
          this.outputText.placeholder = t.translationPlaceholder;

          // Update language selectors
          this.updateLanguageSelectors();

          // Update switch button title
          this.switchBtn.title = t.switchLanguages;

          // Update control buttons
          this.translateBtn.innerHTML = t.translate;
          this.clearBtn.innerHTML = t.clear;
          this.copyBtn.innerHTML = t.copyTranslation;

          // Update loading text
          this.loading.querySelector("p").textContent = t.translating;

          // Update file upload section
          document.querySelector(".file-upload-section h3").textContent =
            t.uploadDocument;
          document.querySelector(".file-upload-section p").textContent =
            t.uploadDescription;
          document.querySelector(".file-input-btn").textContent = t.chooseFile;

          // Update file info labels
          const fileInfoLabels = this.fileInfo.querySelectorAll("p strong");
          if (fileInfoLabels.length >= 3) {
            fileInfoLabels[0].textContent = t.file + ":";
            fileInfoLabels[1].textContent = t.size + ":";
            fileInfoLabels[2].textContent = t.type + ":";
          }

          // Update extracted text section
          const extractedTextTitle = this.extractedText.querySelector("h4");
          if (extractedTextTitle) {
            extractedTextTitle.textContent = t.extractedText;
          }

          const translateFileBtn =
            this.extractedText.querySelector(".translate-btn");
          if (translateFileBtn) {
            translateFileBtn.innerHTML = t.translateExtractedText;
          }

          // Update history section
          if (this.historyToggleBtn) {
            this.historyToggleBtn.innerHTML = `<span>üìö</span> ${t.translationHistory}`;
          }
          
          const historyPanelTitle = document.getElementById("historyPanelTitle");
          if (historyPanelTitle) {
            historyPanelTitle.textContent = t.recentTranslations;
          }
          
          const clearHistoryText = document.getElementById("clearHistoryText");
          if (clearHistoryText) {
            clearHistoryText.textContent = t.clearAllHistory.replace("üóëÔ∏è ", "");
          }
          
          const historyEmptyText = document.getElementById("historyEmptyText");
          if (historyEmptyText) {
            historyEmptyText.textContent = t.noHistoryYet;
          }
          
          const historyEmptySubtext = document.getElementById("historyEmptySubtext");
          if (historyEmptySubtext) {
            historyEmptySubtext.textContent = t.historySubtext;
          }

          // Update footer
          document.getElementById("footerText").textContent =
            t.allRightsReserved;
        }

        updateLanguageSelectors() {
          const t = this.translations[this.currentLang];

          if (this.isVietnameseToLao) {
            this.sourceLang.textContent = t.vietnamese;
            this.targetLang.textContent = t.lao;
          } else {
            this.sourceLang.textContent = t.lao;
            this.targetLang.textContent = t.vietnamese;
          }
        }

        updateDarkModeButton() {
          const t = this.translations[this.currentLang];
          const isDark = document.body.classList.contains("dark-mode");

          if (isDark) {
            this.darkmodeToggle.innerHTML = t.lightMode;
            this.darkmodeToggle.title = t.lightMode;
          } else {
            this.darkmodeToggle.innerHTML = t.darkMode;
            this.darkmodeToggle.title = t.darkMode;
          }
        }

        switchInterfaceLanguage(lang) {
          if (this.translations[lang]) {
            this.currentLang = lang;
            localStorage.setItem("interfaceLanguage", lang);
            this.updateLanguageButtons();
            this.updateInterfaceLanguage();
          }
        }

        attachEventListeners() {
          // Translation controls
          this.translateBtn.addEventListener("click", () =>
            this.translateText()
          );
          this.clearBtn.addEventListener("click", () => this.clearAll());
          this.copyBtn.addEventListener("click", () => this.copyTranslation());
          this.switchBtn.addEventListener("click", () =>
            this.switchLanguages()
          );

          // Character counter
          this.inputText.addEventListener("input", () => this.updateCharCounter());

          // File upload
          this.fileInput.addEventListener("change", (e) =>
            this.handleFileUpload(e)
          );
          this.translateFileBtn.addEventListener("click", () =>
            this.translateExtractedText()
          );

          // Enter key support
          this.inputText.addEventListener("keydown", (e) => {
            if (e.ctrlKey && e.key === "Enter") {
              this.translateText();
            }
          });

          // Dark mode toggle
          this.darkmodeToggle = document.getElementById("darkmodeToggle");
          this.darkmodeToggle.addEventListener("click", () =>
            this.toggleDarkMode()
          );

          // Language switcher
          this.langButtons.forEach((btn) => {
            btn.addEventListener("click", () => {
              this.switchInterfaceLanguage(btn.dataset.lang);
            });
          });

          // History controls
          this.historyToggleBtn.addEventListener("click", () => {
            this.history.toggleHistoryPanel();
          });
          
          this.clearHistoryBtn.addEventListener("click", () => {
            this.history.clearAllHistory();
          });
          
          this.closeHistoryBtn.addEventListener("click", () => {
            this.historyPanel.style.display = 'none';
          });
        }

        initDarkMode() {
          // Check localStorage
          const mode = localStorage.getItem("themeMode");
          if (mode === "dark") {
            document.body.classList.add("dark-mode");
            this.setDarkModeBtn(true);
          } else {
            document.body.classList.remove("dark-mode");
            this.setDarkModeBtn(false);
          }
        }

        toggleDarkMode() {
          const isDark = document.body.classList.toggle("dark-mode");
          localStorage.setItem("themeMode", isDark ? "dark" : "light");
          this.setDarkModeBtn(isDark);
        }

        setDarkModeBtn(isDark) {
          const t = this.translations[this.currentLang];
          if (isDark) {
            this.darkmodeToggle.innerHTML = t.lightMode;
            this.darkmodeToggle.title = t.lightMode;
          } else {
            this.darkmodeToggle.innerHTML = t.darkMode;
            this.darkmodeToggle.title = t.darkMode;
          }
        }

        switchLanguages() {
          this.isVietnameseToLao = !this.isVietnameseToLao;

          // Swap text content
          const inputValue = this.inputText.value;
          const outputValue = this.outputText.value;
          this.inputText.value = outputValue;
          this.outputText.value = inputValue;

          // C·∫≠p nh·∫≠t font styles sau khi switch
          this.updateFontStyles();

          // C·∫≠p nh·∫≠t language selectors v·ªõi b·∫£n d·ªãch
          this.updateLanguageSelectors();
        }

        // Add method for character counter
        updateCharCounter() {
          const currentLength = this.inputText.value.length;
          this.charCounter.textContent = `${currentLength}/${this.charLimit}`;

          if (currentLength > this.charLimit) {
            this.charCounter.classList.add("limit-exceeded");
            this.translateBtn.disabled = true;
          } else {
            this.charCounter.classList.remove("limit-exceeded");
            this.translateBtn.disabled = false;
          }
        }

        // Th√™m method m·ªõi ƒë·ªÉ c·∫≠p nh·∫≠t font styles
        updateFontStyles() {
          // X√≥a c√°c class font c≈©
          this.inputText.classList.remove("lao-text");
          this.outputText.classList.remove("lao-text");

          // √Åp d·ª•ng font theo ng√¥n ng·ªØ hi·ªán t·∫°i
          if (this.isVietnameseToLao) {
            // Input: Vietnamese, Output: Lao
            this.outputText.classList.add("lao-text");
          } else {
            // Input: Lao, Output: Vietnamese
            this.inputText.classList.add("lao-text");
          }
        }

        async translateText(customText = null) {
          const textToTranslate = customText || this.inputText.value.trim();
          const currentLength = this.inputText.value.length;

          if (currentLength > this.charLimit) {
            this.showMessage(
              this.translations[this.currentLang].textLimitExceeded,
              "error"
            );
            return;
          }

          if (!textToTranslate) {
            this.showMessage(
              this.translations[this.currentLang].enterTextToTranslate,
              "error"
            );
            return;
          }

          if (!this.apiKey || this.apiKey === "YOUR_GEMINI_API_KEY_HERE") {
            this.showMessage(
              this.translations[this.currentLang].apiKeyNotConfigured,
              "error"
            );
            return;
          }

          try {
            this.showLoading(true);
            this.translateBtn.disabled = true;

            const translation = await this.callGeminiAPI(textToTranslate);

            if (customText) {
              // If translating extracted text, show in a separate area
              this.showTranslatedFileContent(translation);
              // Save file translation to history
              const direction = this.isVietnameseToLao ? 'vi-lo' : 'lo-vi';
              this.history.saveTranslation(textToTranslate, translation, direction);
            } else {
              this.outputText.value = translation;
              // C·∫≠p nh·∫≠t font styles sau khi c√≥ translation
              this.updateFontStyles();
              // Save regular translation to history
              const direction = this.isVietnameseToLao ? 'vi-lo' : 'lo-vi';
              this.history.saveTranslation(textToTranslate, translation, direction);
            }

            this.showMessage(
              this.translations[this.currentLang].translationCompleted,
              "success"
            );
          } catch (error) {
            console.error("Translation error:", error);
            this.outputText.value = "";
            this.showMessage(
              `${this.translations[this.currentLang].translationFailed} ${
                error.message
              }`,
              "error"
            );
          } finally {
            this.showLoading(false);
            this.translateBtn.disabled = false;
          }
        }

        async callGeminiAPI(text) {
          const sourceLanguage = this.isVietnameseToLao ? "Vietnamese" : "Lao";
          const targetLanguage = this.isVietnameseToLao ? "Lao" : "Vietnamese";

          const prompt = `Translate the following ${sourceLanguage} text to ${targetLanguage}. Return only the complete translation without any explanations, formatting, or additional text:

${text}`;

          const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${this.apiKey}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                contents: [
                  {
                    parts: [
                      {
                        text: prompt,
                      },
                    ],
                  },
                ],
                generationConfig: {
                  temperature: 0.1,
                  maxOutputTokens: 2000, // TƒÉng limit cho text d√†i
                  topP: 0.8,
                  topK: 10,
                },
              }),
            }
          );

          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(
              errorData.error?.message ||
                `API request failed with status ${response.status}`
            );
          }

          const data = await response.json();

          if (
            !data.candidates ||
            !data.candidates[0] ||
            !data.candidates[0].content
          ) {
            throw new Error("Invalid response format from API");
          }

          let translation = data.candidates[0].content.parts[0].text;

          // Clean up the response - nh∆∞ng gi·ªØ nguy√™n c·∫•u tr√∫c ƒëo·∫°n vƒÉn
          translation = translation.replace(/\*\*/g, ""); // Remove bold formatting
          translation = translation.replace(/^.*?translation.*?:/i, "").trim(); // Remove "translation:" prefix
          // ƒê√£ x√≥a d√≤ng remove content in parentheses ƒë·ªÉ gi·ªØ nguy√™n n·ªôi dung trong ()

          // Kh√¥ng c·∫Øt theo d√≤ng ƒë·∫ßu ti√™n n·ªØa - gi·ªØ nguy√™n to√†n b·ªô translation
          // translation = translation.split('\n')[0].trim(); // X√ìA D√íNG N√ÄY

          return translation.trim();
        }

        clearAll() {
          this.inputText.value = "";
          this.outputText.value = "";
          this.hideFileContent();
          this.clearMessages();
        }

        async copyTranslation() {
          const textToCopy = this.outputText.value;

          if (!textToCopy) {
            this.showMessage(
              this.translations[this.currentLang].noTranslationToCopy,
              "error"
            );
            return;
          }

          try {
            await navigator.clipboard.writeText(textToCopy);
            this.showMessage(
              this.translations[this.currentLang].translationCopied,
              "success"
            );
          } catch (error) {
            // Fallback for browsers that don't support clipboard API
            this.outputText.select();
            document.execCommand("copy");
            this.showMessage(
              this.translations[this.currentLang].translationCopied,
              "success"
            );
          }
        }

        async handleFileUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          this.showFileInfo(file);

          try {
            this.showLoading(true);
            let extractedText = "";

            if (
              file.type ===
              "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
            ) {
              extractedText = await this.extractFromDocx(file);
            } else if (file.type === "application/pdf") {
              extractedText = await this.extractFromPdf(file);
            } else if (file.type.startsWith("image/")) {
              extractedText = await this.extractFromImage(file);
            } else {
              throw new Error("Unsupported file type");
            }

            this.showExtractedText(extractedText);
            this.showMessage(
              this.translations[this.currentLang].textExtractedSuccessfully,
              "success"
            );
          } catch (error) {
            console.error("File processing error:", error);
            this.showMessage(
              `${this.translations[this.currentLang].failedToProcessFile} ${
                error.message
              }`,
              "error"
            );
          } finally {
            this.showLoading(false);
          }
        }

        showFileInfo(file) {
          this.fileName.textContent = file.name;
          this.fileSize.textContent = this.formatFileSize(file.size);
          this.fileType.textContent = file.type;
          this.fileInfo.style.display = "block";
        }

        formatFileSize(bytes) {
          if (bytes === 0) return "0 Bytes";
          const k = 1024;
          const sizes = ["Bytes", "KB", "MB", "GB"];
          const i = Math.floor(Math.log(bytes) / Math.log(k));
          return (
            parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i]
          );
        }

        async extractFromDocx(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = async (e) => {
              try {
                const result = await mammoth.extractRawText({
                  arrayBuffer: e.target.result,
                });
                resolve(result.value);
              } catch (error) {
                reject(error);
              }
            };
            reader.onerror = () =>
              reject(new Error("Failed to read DOCX file"));
            reader.readAsArrayBuffer(file);
          });
        }

        async extractFromPdf(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = async (e) => {
              try {
                const pdf = await pdfjsLib.getDocument({
                  data: e.target.result,
                }).promise;
                let fullText = "";

                for (let i = 1; i <= pdf.numPages; i++) {
                  const page = await pdf.getPage(i);
                  const textContent = await page.getTextContent();
                  const pageText = textContent.items
                    .map((item) => item.str)
                    .join(" ");
                  fullText += pageText + "\n";
                }

                resolve(fullText.trim());
              } catch (error) {
                reject(error);
              }
            };
            reader.onerror = () => reject(new Error("Failed to read PDF file"));
            reader.readAsArrayBuffer(file);
          });
        }

        async extractFromImage(file) {
          // For image OCR, we'll use Gemini Vision API
          if (!this.apiKey || this.apiKey === "YOUR_GEMINI_API_KEY_HERE") {
            throw new Error(
              "API key is not configured for image text extraction"
            );
          }

          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = async (e) => {
              try {
                const base64Data = e.target.result.split(",")[1];
                const response = await fetch(
                  `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${this.apiKey}`,
                  {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                      contents: [
                        {
                          parts: [
                            {
                              text: "Extract all text from this image. Return only the extracted text without any additional formatting or explanations.",
                            },
                            {
                              inline_data: {
                                mime_type: file.type,
                                data: base64Data,
                              },
                            },
                          ],
                        },
                      ],
                    }),
                  }
                );

                if (!response.ok) {
                  throw new Error(
                    `API request failed with status ${response.status}`
                  );
                }

                const data = await response.json();
                const extractedText = data.candidates[0].content.parts[0].text;
                resolve(extractedText);
              } catch (error) {
                reject(error);
              }
            };
            reader.onerror = () =>
              reject(new Error("Failed to read image file"));
            reader.readAsDataURL(file);
          });
        }

        showExtractedText(text) {
          this.extractedContent.textContent = text;
          this.extractedText.style.display = "block";
        }

        async translateExtractedText() {
          const extractedText = this.extractedContent.textContent;
          if (!extractedText) {
            this.showMessage(
              this.translations[this.currentLang].noExtractedTextToTranslate,
              "error"
            );
            return;
          }

          await this.translateText(extractedText);
        }

        showTranslatedFileContent(translation) {
          const t = this.translations[this.currentLang];
          const translatedDiv = document.createElement("div");
          translatedDiv.className = "extracted-text";
          translatedDiv.style.borderColor = "#28a745";

          // √Åp d·ª•ng font Lao n·∫øu ƒëang d·ªãch sang ti·∫øng Lao
          const contentClass = this.isVietnameseToLao ? "lao-text" : "";

          // T·∫°o unique ID cho button copy
          const copyBtnId = "copyTranslatedBtn_" + Date.now();
          const contentId = "translatedContent_" + Date.now();

          translatedDiv.innerHTML = `
                    <div class="translated-content-controls">
                        <h4>${t.translation}:</h4>
                        <button class="copy-translated-btn" id="${copyBtnId}">
                            <span>üìã</span> ${t.copyTranslatedText}
                        </button>
                    </div>
                    <div id="${contentId}" class="translated-text-content ${contentClass}">${translation}</div>
                `;

          // Remove any existing translation
          const existingTranslation = document.querySelector(
            '.extracted-text[style*="border-color: rgb(40, 167, 69)"]'
          );
          if (existingTranslation) {
            existingTranslation.remove();
          }

          this.extractedText.parentNode.appendChild(translatedDiv);

          // Th√™m event listener cho button copy
          const copyBtn = document.getElementById(copyBtnId);
          const content = document.getElementById(contentId);

          copyBtn.addEventListener("click", async () => {
            try {
              await navigator.clipboard.writeText(content.textContent);
              this.showMessage(
                this.translations[this.currentLang].translatedTextCopied,
                "success"
              );

              // Visual feedback
              const originalText = copyBtn.innerHTML;
              copyBtn.innerHTML = `<span>‚úÖ</span> ${t.copied}`;
              copyBtn.style.background =
                "linear-gradient(45deg, #28a745, #20c997)";

              setTimeout(() => {
                copyBtn.innerHTML = originalText;
                copyBtn.style.background =
                  "linear-gradient(45deg, #6f42c1, #e83e8c)";
              }, 2000);
            } catch (error) {
              // Fallback for browsers that don't support clipboard API
              const range = document.createRange();
              range.selectNode(content);
              window.getSelection().removeAllRanges();
              window.getSelection().addRange(range);

              try {
                document.execCommand("copy");
                this.showMessage(
                  this.translations[this.currentLang].translatedTextCopied,
                  "success"
                );

                // Visual feedback
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = `<span>‚úÖ</span> ${t.copied}`;
                copyBtn.style.background =
                  "linear-gradient(45deg, #28a745, #20c997)";

                setTimeout(() => {
                  copyBtn.innerHTML = originalText;
                  copyBtn.style.background =
                    "linear-gradient(45deg, #6f42c1, #e83e8c)";
                }, 2000);
              } catch (fallbackError) {
                this.showMessage(
                  this.translations[this.currentLang].failedToCopyText,
                  "error"
                );
              }

              window.getSelection().removeAllRanges();
            }
          });
        }

        hideFileContent() {
          this.fileInfo.style.display = "none";
          this.extractedText.style.display = "none";
          this.fileInput.value = "";

          // Remove translated content
          const translatedContent = document.querySelector(
            '.extracted-text[style*="border-color: rgb(40, 167, 69)"]'
          );
          if (translatedContent) {
            translatedContent.remove();
          }
        }

        showLoading(show) {
          this.loading.style.display = show ? "block" : "none";
        }

        showMessage(message, type) {
          const messageDiv = document.createElement("div");
          messageDiv.className = `${type}-message`;
          messageDiv.textContent = message;

          this.clearMessages();
          this.messages.appendChild(messageDiv);

          // Auto-hide after 5 seconds
          setTimeout(() => {
            messageDiv.remove();
          }, 5000);
        }

        clearMessages() {
          this.messages.innerHTML = "";
        }
      }

      // TranslationHistory class for managing translation history
      class TranslationHistory {
        constructor(translator) {
          this.translator = translator;
          this.maxItems = 50; // Maximum items to store
          this.storageKey = 'lvtranslator_history';
          this.history = this.loadHistory();
        }

        // Save a new translation to history
        saveTranslation(sourceText, translatedText, direction) {
          try {
            if (!sourceText || !translatedText) return;

            const timestamp = Date.now();
            const id = timestamp;

            // Check for duplicate (same source text and direction)
            const existingIndex = this.history.findIndex(
              item => item.sourceText === sourceText && item.direction === direction
            );

            const historyItem = {
              id: id,
              sourceText: sourceText,
              translatedText: translatedText,
              direction: direction,
              timestamp: timestamp,
              preview: {
                source: sourceText.length > 50 ? sourceText.substring(0, 50) + '...' : sourceText,
                translated: translatedText.length > 50 ? translatedText.substring(0, 50) + '...' : translatedText
              }
            };

            if (existingIndex !== -1) {
              // Update existing item timestamp
              this.history[existingIndex] = historyItem;
            } else {
              // Add new item to beginning of array
              this.history.unshift(historyItem);
            }

            // Enforce maxItems limit
            if (this.history.length > this.maxItems) {
              this.history = this.history.slice(0, this.maxItems);
            }

            // Save to localStorage
            this.saveToStorage();
            
            console.log('Translation saved to history:', historyItem);
          } catch (error) {
            console.error('Error saving translation to history:', error);
            this.handleStorageError(error);
          }
        }

        // Load history from localStorage
        loadHistory() {
          try {
            const stored = localStorage.getItem(this.storageKey);
            if (!stored) return [];

            const parsed = JSON.parse(stored);
            if (!Array.isArray(parsed)) return [];

            // Validate and clean data
            return parsed.filter(item => 
              item && 
              typeof item.id === 'number' &&
              typeof item.sourceText === 'string' &&
              typeof item.translatedText === 'string' &&
              typeof item.direction === 'string' &&
              typeof item.timestamp === 'number'
            ).sort((a, b) => b.timestamp - a.timestamp); // Sort by newest first

          } catch (error) {
            console.error('Error loading history from localStorage:', error);
            this.handleStorageError(error);
            return [];
          }
        }

        // Save history to localStorage
        saveToStorage() {
          try {
            localStorage.setItem(this.storageKey, JSON.stringify(this.history));
          } catch (error) {
            console.error('Error saving to localStorage:', error);
            this.handleStorageError(error);
          }
        }

        // Clear all history
        clearHistory() {
          try {
            this.history = [];
            localStorage.removeItem(this.storageKey);
            console.log('History cleared successfully');
            return true;
          } catch (error) {
            console.error('Error clearing history:', error);
            return false;
          }
        }

        // Delete specific item
        deleteItem(id) {
          try {
            const index = this.history.findIndex(item => item.id === id);
            if (index !== -1) {
              this.history.splice(index, 1);
              this.saveToStorage();
              console.log('History item deleted:', id);
              return true;
            }
            return false;
          } catch (error) {
            console.error('Error deleting history item:', error);
            return false;
          }
        }

        // Get history items (with optional limit)
        getHistory(limit = null) {
          const items = [...this.history];
          return limit ? items.slice(0, limit) : items;
        }

        // Handle localStorage errors
        handleStorageError(error) {
          if (error.name === 'QuotaExceededError') {
            // Auto-cleanup: remove oldest 10 items
            console.log('localStorage quota exceeded, cleaning up old items...');
            this.history = this.history.slice(0, this.maxItems - 10);
            try {
              this.saveToStorage();
            } catch (retryError) {
              console.error('Failed to save after cleanup:', retryError);
              // If still failing, clear all history
              this.clearHistory();
            }
          } else {
            // For other errors, clear corrupted data
            console.log('Clearing corrupted history data...');
            this.clearHistory();
          }
        }

        // Check if localStorage is available
        isStorageAvailable() {
          try {
            const test = '__storage_test__';
            localStorage.setItem(test, test);
            localStorage.removeItem(test);
            return true;
          } catch (error) {
            return false;
          }
        }

        // UI Methods
        
        // Toggle history panel visibility
        toggleHistoryPanel() {
          const panel = document.getElementById('historyPanel');
          const isVisible = panel.style.display !== 'none';
          
          if (isVisible) {
            panel.style.display = 'none';
          } else {
            panel.style.display = 'block';
            this.renderHistory();
          }
        }

        // Render history items in the UI
        renderHistory() {
          const historyContent = document.getElementById('historyContent');
          const historyEmpty = document.getElementById('historyEmpty');
          
          if (!historyContent || !historyEmpty) return;

          const historyItems = this.getHistory(20); // Show max 20 items

          if (historyItems.length === 0) {
            historyContent.innerHTML = '';
            historyEmpty.style.display = 'block';
            return;
          }

          historyEmpty.style.display = 'none';
          historyContent.innerHTML = historyItems.map(item => this.createHistoryItemHTML(item)).join('');

          // Add event listeners to history items
          this.attachHistoryItemListeners();
        }

        // Create HTML for a single history item
        createHistoryItemHTML(item) {
          const sourceTag = item.direction === 'vi-lo' ? 'VI' : 'LO';
          const targetTag = item.direction === 'vi-lo' ? 'LO' : 'VI';
          const sourceLaoClass = item.direction === 'lo-vi' ? 'lao-text' : '';
          const targetLaoClass = item.direction === 'vi-lo' ? 'lao-text' : '';

          return `
            <div class="history-item" data-id="${item.id}">
              <div class="history-item-content">
                <div class="history-item-text">
                  <div class="source-text">
                    <span class="language-tag">${sourceTag}</span>
                    <span class="text-preview ${sourceLaoClass}">${this.escapeHtml(item.preview.source)}</span>
                  </div>
                  <div class="arrow">‚Üí</div>
                  <div class="translated-text">
                    <span class="language-tag">${targetTag}</span>
                    <span class="text-preview ${targetLaoClass}">${this.escapeHtml(item.preview.translated)}</span>
                  </div>
                </div>
                <div class="history-item-meta">
                  <span class="timestamp">${this.formatTimestamp(item.timestamp)}</span>
                </div>
              </div>
              <div class="history-item-actions">
                <button class="use-translation-btn" title="Use this translation" data-action="use" data-id="${item.id}">
                  <span>‚Ü©Ô∏è</span>
                </button>
                <button class="delete-item-btn" title="Delete this item" data-action="delete" data-id="${item.id}">
                  <span>üóëÔ∏è</span>
                </button>
              </div>
            </div>
          `;
        }

        // Format timestamp to relative time
        formatTimestamp(timestamp) {
          const now = Date.now();
          const diff = now - timestamp;
          
          const seconds = Math.floor(diff / 1000);
          const minutes = Math.floor(seconds / 60);
          const hours = Math.floor(minutes / 60);
          const days = Math.floor(hours / 24);

          const t = this.translator.translations[this.translator.currentLang];

          if (seconds < 60) {
            return t.justNow;
          } else if (minutes < 60) {
            return `${minutes} ${minutes > 1 ? t.minutesAgo : t.minuteAgo}`;
          } else if (hours < 24) {
            return `${hours} ${hours > 1 ? t.hoursAgo : t.hourAgo}`;
          } else if (days < 7) {
            return `${days} ${days > 1 ? t.daysAgo : t.dayAgo}`;
          } else {
            return new Date(timestamp).toLocaleDateString();
          }
        }

        // Escape HTML to prevent XSS
        escapeHtml(text) {
          const div = document.createElement('div');
          div.textContent = text;
          return div.innerHTML;
        }

        // Attach event listeners to history items
        attachHistoryItemListeners() {
          const historyItems = document.querySelectorAll('.history-item');
          
          historyItems.forEach(item => {
            // Click on item content to use translation
            const content = item.querySelector('.history-item-content');
            content.addEventListener('click', (e) => {
              e.stopPropagation();
              const id = parseInt(item.dataset.id);
              this.useTranslation(id);
            });

            // Action buttons
            const actionButtons = item.querySelectorAll('[data-action]');
            actionButtons.forEach(button => {
              button.addEventListener('click', (e) => {
                e.stopPropagation();
                const action = button.dataset.action;
                const id = parseInt(button.dataset.id);
                
                if (action === 'use') {
                  this.useTranslation(id);
                } else if (action === 'delete') {
                  this.deleteItemWithConfirmation(id);
                }
              });
            });
          });
        }

        // Use translation from history
        useTranslation(id) {
          const item = this.history.find(h => h.id === id);
          if (!item) return;

          // Set the correct direction
          const shouldBeViToLao = item.direction === 'vi-lo';
          if (this.translator.isVietnameseToLao !== shouldBeViToLao) {
            this.translator.switchLanguages();
          }

          // Fill the input and output fields
          this.translator.inputText.value = item.sourceText;
          this.translator.outputText.value = item.translatedText;

          // Update font styles
          this.translator.updateFontStyles();

          // Close history panel
          document.getElementById('historyPanel').style.display = 'none';

          // Show success message
          const t = this.translator.translations[this.translator.currentLang];
          this.translator.showMessage(t.historyLoadedFromHistory, 'success');
        }

        // Delete item with confirmation for individual items
        deleteItemWithConfirmation(id) {
          const success = this.deleteItem(id);
          if (success) {
            this.renderHistory();
            const t = this.translator.translations[this.translator.currentLang];
            this.translator.showMessage(t.historyItemDeleted, 'success');
          }
        }

        // Clear all history with confirmation
        clearAllHistory() {
          const t = this.translator.translations[this.translator.currentLang];
          
          if (confirm(t.confirmClearHistory)) {
            const success = this.clearHistory();
            if (success) {
              this.renderHistory();
              this.translator.showMessage(t.historyCleared, 'success');
            } else {
              this.translator.showMessage('Failed to clear history', 'error');
            }
          }
        }
      }

      // Initialize the application
      document.addEventListener("DOMContentLoaded", () => {
        new VietnameseLaoTranslator();

        // Set copyright year
        var year = new Date().getFullYear();
        document.getElementById("copyrightYear").textContent = year;

        // --- Buy Me a Coffee Modal Logic ---
        const bmcModal = document.getElementById("bmc-modal");
        const bmcLink = document.getElementById("buy-me-a-coffee");
        const bmcCloseBtn = document.querySelector(".bmc-close-btn");

        if (bmcLink) {
          bmcLink.onclick = function () {
            bmcModal.style.display = "block";
          };
        }
        if (bmcCloseBtn) {
          bmcCloseBtn.onclick = function () {
            bmcModal.style.display = "none";
          };
        }
        window.onclick = function (event) {
          if (event.target == bmcModal) {
            bmcModal.style.display = "none";
          }
        };

        // --- Privacy Policy Modal Logic ---
        const privacyModal = document.getElementById("privacy-policy-modal");
        const consentBtn = document.getElementById("privacy-consent-btn");
        
        const hasConsented = localStorage.getItem("privacyConsent");

        if (!hasConsented) {
          privacyModal.style.display = "flex";
        }

        if (consentBtn) {
            consentBtn.addEventListener("click", function () {
              localStorage.setItem("privacyConsent", "true");
              privacyModal.style.display = "none";
            });
        }
      });
    </script>
  </body>
</html>
